<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ëŸ°ìŠ¤íƒ ë‹¤ë“œ | ë§ˆë¼í†¤ í‰ì  ì»¤ë®¤ë‹ˆí‹°</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="config.js"></script>
    <style>
        :root { --main-color: #e91e63; --bg-color: #f0f2f5; --bg-light: #f8f9fa; }
        body { font-family: 'Pretendard', sans-serif; background-color: var(--bg-color); margin: 0; color: #333; line-height: 1.6; }
        
        /* ë„¤ë¹„ê²Œì´ì…˜ */
        .nav-container { background: white; border-bottom: 1px solid #eee; display: flex; justify-content: center; padding: 12px 0; gap: 15px; position: sticky; top: 0; z-index: 100; }
        .nav-item { text-decoration: none; color: #666; font-size: 0.95rem; font-weight: 600; padding: 10px 20px; border-radius: 25px; transition: 0.3s; }
        .nav-item.active { background: var(--main-color); color: white; box-shadow: 0 4px 10px rgba(233, 30, 99, 0.2); }

        .container { max-width: 800px; margin: 1rem auto; padding: 0 1rem; }
        
        /* ğŸ“ ì»´íŒ©íŠ¸ í—¤ë” & ê²€ìƒ‰ */
        .page-header { background: white; border-radius: 20px; padding: 1rem 1.5rem; margin-bottom: 0.8rem; text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.03); }
        .header-title { font-size: 1.4rem; font-weight: 900; color: #1a1a1a; margin-bottom: 4px; }
        .header-subtitle { color: #e91e63; font-weight: 700; font-size: 0.85rem; }

        .search-container { margin-bottom: 1rem; display: flex; gap: 10px; }
        #search-input { flex: 1; padding: 10px 20px; border-radius: 15px; border: 2px solid white; background: white; box-shadow: 0 4px 12px rgba(0,0,0,0.04); font-size: 0.95rem; outline: none; }
        .write-btn { padding: 10px 25px; background: var(--main-color); color: white; border: none; border-radius: 15px; font-weight: 800; cursor: pointer; transition: 0.2s; }

        /* ğŸ“‹ ê²Œì‹œê¸€ ëª©ë¡ ì¹´ë“œ */
        .post-card { background: white; border-radius: 20px; padding: 1.5rem; margin-bottom: 1rem; box-shadow: 0 4px 12px rgba(0,0,0,0.04); cursor: pointer; transition: 0.2s; }
        .post-card:hover { transform: translateY(-3px); box-shadow: 0 8px 20px rgba(0,0,0,0.08); }
        .post-category { display: inline-block; padding: 3px 10px; border-radius: 6px; background: #fff0f5; color: var(--main-color); font-size: 0.75rem; font-weight: 800; margin-bottom: 8px; }
        .post-title { font-size: 1.15rem; font-weight: 800; margin-bottom: 8px; color: #222; }
        .post-meta { display: flex; justify-content: space-between; align-items: center; font-size: 0.85rem; color: #999; font-weight: 500; }

        /* âœï¸ ê¸€ì“°ê¸° ì–‘ì‹ (ì´ˆê¸° ìˆ¨ê¹€) */
        #write-section { display: none; background: white; border-radius: 24px; padding: 2rem; margin-bottom: 1.5rem; box-shadow: 0 8px 25px rgba(0,0,0,0.05); }
        .form-group { margin-bottom: 1.2rem; }
        .form-group label { display: block; font-weight: 800; font-size: 0.9rem; margin-bottom: 8px; color: #555; }
        .form-input { width: 100%; padding: 12px 15px; border-radius: 12px; border: 1px solid #eee; background: #fcfcfc; box-sizing: border-box; font-size: 1rem; }
        .form-textarea { width: 100%; height: 200px; padding: 15px; border-radius: 12px; border: 1px solid #eee; background: #fcfcfc; box-sizing: border-box; font-size: 1rem; resize: none; }
        .submit-group { display: flex; gap: 10px; }
        .cancel-btn { flex: 1; padding: 15px; background: #eee; border: none; border-radius: 15px; font-weight: bold; cursor: pointer; }
        .save-btn { flex: 2; padding: 15px; background: var(--main-color); color: white; border: none; border-radius: 15px; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

<nav class="nav-container">
    <a href="index.html" class="nav-item">í™ˆ</a>
    <a href="rating.html" class="nav-item">ëŒ€íšŒí‰ì </a>
    <a href="schedule.html" class="nav-item">ëŒ€íšŒì¼ì •</a>
    <a href="board.html" class="nav-item active">ì»¤ë®¤ë‹ˆí‹°</a>
</nav>

<div class="container">
    <div class="page-header">
        <div class="header-title">ğŸ’¬ ëŸ¬ë„ˆ ê´‘ì¥</div>
        <div class="header-subtitle">ëŸ°ìŠ¤íƒ ë‹¤ë“œì—ì„œ ììœ ë¡­ê²Œ ë‹¬ë¦¬ê¸° ì´ì•¼ê¸°ë¥¼ ë‚˜ëˆ„ì–´ ë³´ì„¸ìš”.</div>
    </div>

    <div class="search-container">
        <input type="text" id="search-input" placeholder="ê´€ì‹¬ ìˆëŠ” í‚¤ì›Œë“œë¥¼ ê²€ìƒ‰í•˜ì„¸ìš”..." onkeyup="filterPosts()">
        <button class="write-btn" onclick="toggleWriteSection(true)">ê¸€ì“°ê¸°</button>
    </div>

    <div id="write-section">
        <h3 style="margin-top:0;">ê¸€ ì‘ì„±í•˜ê¸°</h3>
        <div class="form-group">
            <label>ì¹´í…Œê³ ë¦¬</label>
            <select id="post-category" class="form-input">
                <option value="ììœ ">ììœ ìˆ˜ë‹¤</option>
                <option value="í›ˆë ¨">í›ˆë ¨ë°©ë²•</option>
                <option value="ì¥ë¹„">ëŸ¬ë‹ì¥ë¹„</option>
                <option value="ëŒ€íšŒ">ëŒ€íšŒí›„ê¸°</option>
            </select>
        </div>
        <div class="form-group">
            <label>ì œëª©</label>
            <input type="text" id="post-title" class="form-input" placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”.">
        </div>
        <div class="form-group">
            <label>ë‚´ìš©</label>
            <textarea id="post-content" class="form-textarea" placeholder="ëŸ¬ë„ˆë“¤ê³¼ ë‚˜ëˆ„ê³  ì‹¶ì€ ì´ì•¼ê¸°ë¥¼ ì ì–´ì£¼ì„¸ìš”."></textarea>
        </div>
        <div class="submit-group">
            <button class="cancel-btn" onclick="toggleWriteSection(false)">ì·¨ì†Œ</button>
            <button class="save-btn" onclick="savePost()">ë“±ë¡í•˜ê¸°</button>
        </div>
    </div>

    <div id="post-list">
        <p style="text-align: center; padding: 3rem; color: #adb5bd;">ê²Œì‹œê¸€ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
    </div>
</div>

<script>
    const _supabase = supabase.createClient(CONFIG.SUPABASE_URL, CONFIG.SUPABASE_KEY);
    let allPosts = [];

    // [A] ê³ ìœ  ID ì‹œìŠ¤í…œ (rating.htmlê³¼ ë™ì¼ ë¡œì§)
    const NICKNAMES = ["í’€ì½”ìŠ¤ì™„ì£¼ì", "ë³´ê¸‰ì†Œí„¸ì´ë²”", "ëŸ¬ë‹ì€ì¥ë¹„ë¹¨", "ì¹´ë³¸í™”ì„±ì• ì", "ëŒ€íšŒìˆ˜ì§‘ê°€", "ì•„ë¯¸ë…¸ë°”ì´íƒˆì¤‘ë…", "ì„œë¸Œ3ê¿ˆë‚˜ë¬´", "ì—…íìš”ì •"];
    function generateUniqueId() {
        const nick = NICKNAMES[Math.floor(Math.random() * NICKNAMES.length)];
        const randNum = Math.floor(Math.random() * (99999 - 10000 + 1)) + 10000;
        return `${nick}_${randNum}`;
    }

    // [B] ë°ì´í„° ë¡œë“œ ë° ë Œë”ë§
    async function loadPosts() {
        const { data, error } = await _supabase.from('posts').select('*').order('created_at', { ascending: false });
        if (error) return;
        allPosts = data;
        renderPosts(allPosts);
    }

    function renderPosts(posts) {
        const container = document.getElementById('post-list');
        if (posts.length === 0) {
            container.innerHTML = '<p style="text-align: center; padding: 3rem; color: #adb5bd;">ì‘ì„±ëœ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
            return;
        }
        container.innerHTML = posts.map(post => `
            <div class="post-card">
                <span class="post-category">${post.category}</span>
                <div class="post-title">${post.title}</div>
                <div class="post-meta">
                    <span>ğŸ‘¤ ${post.author_id}</span>
                    <span>ğŸ“… ${new Date(post.created_at).toLocaleDateString()}</span>
                </div>
            </div>
        `).join('');
    }

    // [C] ê²€ìƒ‰ í•„í„°ë§
    function filterPosts() {
        const query = document.getElementById('search-input').value.toLowerCase();
        const filtered = allPosts.filter(p => p.title.toLowerCase().includes(query) || p.content.toLowerCase().includes(query));
        renderPosts(filtered);
    }

    // [D] ê¸€ì“°ê¸° ì„¹ì…˜ í† ê¸€
    function toggleWriteSection(show) {
        document.getElementById('write-section').style.display = show ? 'block' : 'none';
        document.getElementById('post-list').style.display = show ? 'none' : 'block';
        if (show) window.scrollTo(0, 0);
    }

    // [E] ê¸€ ì €ì¥
    async function savePost() {
        const title = document.getElementById('post-title').value;
        const content = document.getElementById('post-content').value;
        const category = document.getElementById('post-category').value;

        if (!title || !content) {
            alert('ì œëª©ê³¼ ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            return;
        }

        const newPost = {
            title,
            content,
            category,
            author_id: generateUniqueId() // ê³ ìœ  ìµëª… ID ë¶€ì—¬
        };

        const { error } = await _supabase.from('posts').insert([newPost]);
        if (error) {
            alert('ë“±ë¡ ì‹¤íŒ¨: ' + error.message);
        } else {
            alert('ê¸€ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!');
            location.reload();
        }
    }

    window.onload = loadPosts;
</script>
</body>
</html>