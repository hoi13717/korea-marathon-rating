<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>런스탠다드 | 대회 상세 정보</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="config.js"></script>
    <script src="navbar.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css">
    <style>
        :root { 
            --main-color: #e91e63; --pro-color: #66cc33; --bg-color: #f8f9fa;
            --score-red: #ff5252; --score-orange: #ffa726; --score-green: #4caf50; --best-gold: #ffc107;
        }
        body { font-family: 'Pretendard', sans-serif; background-color: var(--bg-color); margin: 0; padding-bottom: 50px; color: #333; }
        .container { max-width: 800px; margin: 0 auto; padding: 20px 1rem; }

        .video-container { width: 100%; aspect-ratio: 16 / 9; border-radius: 20px; overflow: hidden; background: #000; box-shadow: 0 10px 30px rgba(0,0,0,0.1); margin-bottom: 25px; }

        /* 수직형 스코어 영역 */
        .score-stack { display: flex; flex-direction: column; gap: 15px; margin-bottom: 25px; }
        .score-card { background: white; border-radius: 25px; padding: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.02); }
        .score-header { display: flex; align-items: center; gap: 15px; }
        .badge-circle { width: 75px; height: 75px; border-radius: 22px; display: flex; flex-direction: column; align-items: center; justify-content: center; color: white; font-weight: 900; }
        .num-lg { font-size: 2rem; line-height: 1; }
        .label-sm { font-size: 0.65rem; margin-top: 4px; font-weight: 800; }

        .best-mini-wrap { background: #fffdf0; border: 1.5px solid var(--best-gold); margin-top: 15px; padding: 15px; border-radius: 20px; }

        /* ⭐ 1, 2. 입력창 및 프로그레스 바 스타일 개선 */
        .rating-card { background: white; border-radius: 25px; padding: 25px; margin-bottom: 30px; box-shadow: 0 8px 20px rgba(0,0,0,0.05); }
        .input-row { display: flex; gap: 10px; margin-bottom: 12px; flex-wrap: wrap; }
        .form-input { flex: 1; min-width: 140px; padding: 12px 15px; border-radius: 12px; border: 1.5px solid #eee; font-size: 0.9rem; outline: none; transition: 0.3s; }
        .form-input:focus { border-color: var(--main-color); }

        .comment-wrapper { width: 100%; margin-bottom: 10px; }
        .comment-area { 
            width: 100%; height: 160px; /* 사이즈 수정 */
            padding: 15px; border-radius: 15px; border: 1.5px solid #eee; 
            font-size: 1rem; resize: none; box-sizing: border-box; outline: none; 
            font-family: inherit; line-height: 1.6; transition: 0.3s;
        }
        .comment-area:focus { border-color: var(--main-color); background: #fffafc; }

        /* 프로그레스 바 레이아웃 */
        .progress-container { display: flex; align-items: center; gap: 10px; margin-top: 8px; margin-bottom: 20px; }
        .progress-bg { flex: 1; height: 6px; background: #eee; border-radius: 10px; overflow: hidden; }
        .progress-fill { width: 0%; height: 100%; background: var(--main-color); transition: 0.2s; }
        .char-count { font-size: 0.8rem; color: #999; font-weight: 700; min-width: 55px; text-align: right; }

        /* ⭐ 3. 코멘트남기기 버튼 */
        .submit-btn { width: 100%; padding: 18px; background: var(--main-color); color: white; border: none; border-radius: 15px; font-weight: 900; font-size: 1.1rem; cursor: pointer; transition: 0.3s; }
        .submit-btn:hover { background: #d81b60; transform: translateY(-2px); }

        /* ⭐ 4. 자동 줄바꿈 처리 */
        .review-item { background: white; border-radius: 22px; padding: 22px; margin-top: 15px; border: 1px solid #f0f0f0; }
        .review-text { 
            font-size: 0.95rem; line-height: 1.7; color: #444; 
            white-space: pre-wrap; /* 줄바꿈 유지 */
            word-break: break-all; /* 긴 단어 강제 줄바꿈 */
            overflow-wrap: break-word; 
        }

        .interaction-bar { display: flex; gap: 15px; margin-top: 15px; border-top: 1px solid #f8f8f8; padding-top: 15px; align-items: center; }
        .inter-btn { background: #fff; border: 1.5px solid #eee; padding: 6px 12px; border-radius: 50px; font-size: 0.8rem; color: #777; cursor: pointer; font-weight: 700; display: flex; align-items: center; gap: 5px; }
        .inter-btn:hover { border-color: var(--main-color); color: var(--main-color); }
        .user-avg-badge { padding: 3px 8px; border-radius: 10px; color: #fff; font-weight: 900; font-size: 0.75rem; margin-left: 5px; }
        .bg-red { background: var(--score-red); } .bg-orange { background: var(--score-orange); } .bg-green { background: var(--score-green); }
    </style>
</head>
<body>
    <div class="container">
        <div id="status-view" style="text-align:center; padding:100px 0;"><i class="fa-solid fa-spinner fa-spin fa-2x" style="color:#eee;"></i></div>

        <div id="main-view" style="display:none;">
            <h2 id="race-title" style="font-weight: 900; letter-spacing: -1.8px; margin-bottom: 25px; font-size: 2rem;"></h2>
            
            <div class="video-container"><iframe id="youtube-player" width="100%" height="100%" frameborder="0" allowfullscreen></iframe></div>

            <div id="score-area" class="score-stack"></div>

            <div class="rating-card" id="input-card">
                <div class="input-row">
                    <input type="text" id="v-author" class="form-input" placeholder="작성자">
                    <input type="password" id="v-pw" class="form-input" maxlength="6" placeholder="암호 6자리">
                </div>
                
                <div class="comment-wrapper">
                    <textarea id="v-comment" class="comment-area" maxlength="300" placeholder="의미 없는 공백 없는 소중한 후기를 남겨주세요. (최대 300자)"></textarea>
                    <div class="progress-container">
                        <div class="progress-bg"><div id="v-progress-fill" class="progress-fill"></div></div>
                        <div class="char-count"><span id="v-char-now">0</span> / 300</div>
                    </div>
                </div>
                
                <button onclick="submitVote()" class="submit-btn">코멘트남기기</button>
            </div>

            <div id="review-list"></div>
        </div>
    </div>

    <script>
        // ... (Supabase 설정 및 기존 변수 생략)

        // ⭐ 2. 실시간 글자수 및 프로그레스 바 제어
        const commentEl = document.getElementById('v-comment');
        const fillEl = document.getElementById('v-progress-fill');
        const countEl = document.getElementById('v-char-now');

        commentEl.addEventListener('input', () => {
            const len = commentEl.value.length;
            const per = (len / 300) * 100;
            
            countEl.innerText = len;
            fillEl.style.width = per + '%';

            // 임계치 도달 시 색상 변화로 경고
            if (per > 90) fillEl.style.background = 'var(--score-red)';
            else if (per > 70) fillEl.style.background = 'var(--score-orange)';
            else fillEl.style.background = 'var(--main-color)';
        });

        // ⭐ 4. 자동 줄바꿈 로직은 CSS (white-space, word-break)로 완벽히 처리되었습니다.

        // (이후 기존 handleLike, handleReport, loadMore 등 로직 동일)
    </script>
</body>
</html>