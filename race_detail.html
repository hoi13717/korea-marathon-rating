<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ëŸ°ìŠ¤íƒ ë‹¤ë“œ | ëŒ€íšŒ ìƒì„¸ ì •ë³´</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="config.js"></script>
    <script src="navbar.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css">
    <style>
        :root { 
            --main-color: #e91e63; 
            --pro-color: #66cc33; 
            --bg-color: #f8f9fa;
            --score-red: #ff5252; 
            --score-orange: #ffa726; 
            --score-green: #4caf50; 
        }
        body { 
            font-family: 'Pretendard', sans-serif; 
            background-color: var(--bg-color); 
            margin: 0; 
            padding-bottom: 50px; 
            color: #333; 
        }
        .container { 
            max-width: 800px; 
            margin: 0 auto; 
            padding: 20px 1rem; 
        }

        /* 16. ì˜ìƒ ì˜ì—­ í¬ê¸° ìœ ì§€ */
        .video-container { 
            width: 100%; 
            aspect-ratio: 16 / 9; 
            border-radius: 20px; 
            overflow: hidden; 
            background: #000; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.1); 
            margin-bottom: 25px; 
        }

        /* 13. ê´€ë¦¬ì ê°œìš” ì˜ì—­ */
        .admin-box { 
            background: #fff; 
            padding: 25px; 
            border-radius: 20px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.03); 
            margin-bottom: 25px; 
            border-left: 6px solid var(--main-color); 
        }
        .admin-box h4 { 
            margin: 0 0 10px 0; 
            font-size: 1rem; 
            color: var(--main-color); 
            display: flex; 
            align-items: center; 
            gap: 8px; 
        }
        .admin-text {
            font-size: 0.95rem;
            line-height: 1.6;
            color: #555;
        }

        /* 1, 14. ìˆ˜ì§í˜• ìŠ¤ì½”ì–´ ì˜ì—­ */
        .score-stack { 
            display: flex; 
            flex-direction: column; 
            gap: 15px; 
            margin-bottom: 30px; 
        }
        .score-card { 
            background: white; 
            border-radius: 25px; 
            padding: 25px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.02); 
        }
        .score-header { 
            display: flex; 
            align-items: center; 
            gap: 15px; 
        }
        .badge-circle { 
            width: 70px; 
            height: 70px; 
            border-radius: 20px; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            color: white; 
            font-weight: 900; 
        }
        .num-lg { 
            font-size: 1.8rem; 
            line-height: 1; 
        }
        .label-sm { 
            font-size: 0.6rem; 
            margin-top: 3px; 
            font-weight: 800; 
        }

        /* 2, 15. ìœ ì € í‰ì  ì˜ì—­ ë‚´ ë² ìŠ¤íŠ¸ ëŒ“ê¸€ */
        .best-mini-container { 
            margin-top: 15px; 
            border-top: 1px solid #f5f5f5; 
            padding-top: 15px; 
        }
        .best-mini-item { 
            background: #fffdf0; 
            border: 1px solid #fff5cc; 
            padding: 12px; 
            border-radius: 12px; 
            margin-bottom: 8px; 
            font-size: 0.85rem; 
        }
        .best-tag { 
            background: #ffc107; 
            color: #856404; 
            font-size: 0.65rem; 
            padding: 2px 6px; 
            border-radius: 4px; 
            font-weight: 900; 
            margin-right: 6px; 
        }
        .more-text-btn {
            color: var(--main-color);
            cursor: pointer;
            text-decoration: underline;
            font-weight: 600;
        }
        .more-text-btn:hover {
            opacity: 0.7;
        }

        /* 8, 9. ë¦¬ë·° ì•„ì´í…œ */
        .review-item { 
            background: white; 
            border-radius: 20px; 
            padding: 20px; 
            margin-bottom: 15px; 
            box-shadow: 0 3px 12px rgba(0,0,0,0.02); 
        }
        .review-meta { 
            display: flex; 
            justify-content: space-between; 
            margin-bottom: 12px; 
            font-size: 0.85rem; 
            color: #999; 
        }
        .review-scores { 
            display: flex; 
            flex-wrap: wrap; 
            gap: 8px; 
            margin-bottom: 12px; 
        }
        .score-tag { 
            background: #f5f5f5; 
            padding: 5px 10px; 
            border-radius: 12px; 
            font-size: 0.75rem; 
            font-weight: 700; 
            color: #666; 
        }

        /* 9. ì ìˆ˜ë³„ ìƒ‰ìƒ ê·œê²© */
        .bg-red { background: var(--score-red); } 
        .bg-orange { background: var(--score-orange); } 
        .bg-green { background: var(--score-green); }

        /* 12. ì½”ë©˜íŠ¸ ê³µë°± ìµœì í™” */
        .review-text { 
            font-size: 0.95rem; 
            line-height: 1.6; 
            color: #444; 
            white-space: pre-wrap; 
            word-break: break-all; 
        }

        /* ê³µí†µ ë²„íŠ¼ */
        .interaction-bar { 
            display: flex; 
            gap: 18px; 
            margin-top: 15px; 
            border-top: 1px solid #f8f8f8; 
            padding-top: 12px; 
        }
        .inter-btn { 
            background: none; 
            border: none; 
            font-size: 0.8rem; 
            color: #999; 
            cursor: pointer; 
            font-weight: 700; 
            display: flex; 
            align-items: center; 
            gap: 5px; 
            transition: color 0.2s;
        }
        .inter-btn:hover {
            color: var(--main-color);
        }
        .review-actions {
            margin-left: auto;
        }
        .review-actions span {
            color: #999;
            font-size: 0.8rem;
            cursor: pointer;
            font-weight: 700;
        }
        .review-actions span:hover {
            color: var(--main-color);
        }

        /* 11. ì—°ê´€ ëŒ€íšŒ */
        .related-grid { 
            display: grid; 
            grid-template-columns: repeat(2, 1fr); 
            gap: 15px; 
            margin-top: 20px; 
        }
        .rel-card { 
            background: white; 
            border-radius: 15px; 
            overflow: hidden; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.04); 
            cursor: pointer; 
            transition: 0.3s; 
        }
        .rel-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.08);
        }
        .rel-title { 
            padding: 12px; 
            font-size: 0.85rem; 
            font-weight: 800; 
            white-space: nowrap; 
            overflow: hidden; 
            text-overflow: ellipsis; 
        }

        .load-more-btn {
            padding: 12px 35px; 
            border-radius: 50px; 
            border: 1px solid #ddd; 
            background: #fff; 
            cursor: pointer; 
            font-weight: 800; 
            color: #888;
            transition: all 0.3s;
        }
        .load-more-btn:hover {
            background: var(--main-color);
            color: white;
            border-color: var(--main-color);
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="status-view" style="text-align:center; padding:100px 0;">
            <i class="fa-solid fa-spinner fa-spin fa-3x" style="color:#eee;"></i>
        </div>

        <div id="main-view" style="display:none;">
            <h2 id="race-title" style="font-weight: 900; letter-spacing: -1.5px; margin-bottom: 20px; font-size: 1.8rem;"></h2>
            
            <!-- 16. ì˜ìƒ ì˜ì—­ -->
            <div class="video-container">
                <iframe id="youtube-player" width="100%" height="100%" frameborder="0" allowfullscreen></iframe>
            </div>

            <!-- 13. ê´€ë¦¬ì ê°œìš” ì˜ì—­ -->
            <div class="admin-box">
                <h4><i class="fa-solid fa-file-invoice"></i> ì‚¬ì´íŠ¸ ê´€ë¦¬ì í•œë§ˆë””</h4>
                <div id="admin-desc" class="admin-text"></div>
            </div>

            <!-- 1, 14. ìˆ˜ì§í˜• ìŠ¤ì½”ì–´ ì˜ì—­ -->
            <div class="score-stack">
                <!-- ì „ë¬¸ê°€ í‰ê·  í‰ì  -->
                <div class="score-card">
                    <div class="score-header">
                        <div class="badge-circle" style="background:var(--pro-color);">
                            <span class="num-lg" id="pro-val">-</span>
                            <span class="label-sm">PROS</span>
                        </div>
                        <div>
                            <h4 style="margin:0; font-size:1.1rem;">ì „ë¬¸ê°€ í‰ê·  í‰ì </h4>
                            <p style="margin:2px 0 0; font-size:0.8rem; color:#999;">ëŸ¬ë‹ ì¸í”Œë£¨ì–¸ì„œ ê³µì‹ ê¸°ë¡</p>
                        </div>
                    </div>
                </div>
                
                <!-- ëŸ¬ë„ˆ í‰ê·  í‰ì  + ë² ìŠ¤íŠ¸ ëŒ“ê¸€ -->
                <div class="score-card">
                    <div class="score-header">
                        <div class="badge-circle" id="user-avg-badge">
                            <span class="num-lg" id="user-val">-</span>
                            <span class="label-sm">USERS</span>
                        </div>
                        <div>
                            <h4 style="margin:0; font-size:1.1rem;">ëŸ¬ë„ˆ í‰ê·  í‰ì </h4>
                            <p id="user-count" style="margin:2px 0 0; font-size:0.8rem; color:#999;"></p>
                        </div>
                    </div>
                    <!-- 15. ë² ìŠ¤íŠ¸ ëŒ“ê¸€ ì˜ì—­ -->
                    <div id="best-comments-area" class="best-mini-container"></div>
                </div>
            </div>

            <!-- 3. ë¦¬ë·° ë¦¬ìŠ¤íŠ¸ -->
            <div id="review-list"></div>
            
            <!-- 3. ë”ë³´ê¸° ë²„íŠ¼ -->
            <div id="load-more-container" style="text-align:center; margin:30px 0;">
                <button class="load-more-btn" onclick="loadMore()">ë¦¬ë·° 10ê°œ ë”ë³´ê¸°</button>
            </div>

            <!-- 11. ì—°ê´€ ëŒ€íšŒ -->
            <div style="margin-top:50px; border-top:1px solid #eee; padding-top:30px;">
                <h3 style="font-size:1.1rem; font-weight:900;">
                    <i class="fa-solid fa-link"></i> ì§€ê¸ˆ ê°€ì¥ í•«í•œ ë ˆì´ìŠ¤
                </h3>
                <div class="related-grid" id="related-list"></div>
            </div>
        </div>
    </div>

    <script>
        const _supabase = supabase.createClient(CONFIG.SUPABASE_URL, CONFIG.SUPABASE_KEY);
        const urlParams = new URLSearchParams(window.location.search);
        const raceId = urlParams.get('id');

        let offset = 0;
        let bestIds = [];

        // 1, 9. ì ìˆ˜ ìƒ‰ìƒ ê·œê²© í•¨ìˆ˜
        function getScoreColorClass(score) {
            if (score <= 3) return 'bg-red';
            if (score <= 6) return 'bg-orange';
            return 'bg-green';
        }

        async function init() {
            if (!raceId) {
                alert('ëŒ€íšŒ IDê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            try {
                // ì¡°íšŒìˆ˜ ì¦ê°€
                await _supabase.rpc('increment_views', { r_id: raceId });

                // ëŒ€íšŒ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                const { data: race, error: raceError } = await _supabase
                    .from('schedules')
                    .select('*')
                    .eq('id', raceId)
                    .single();

                if (raceError) throw raceError;

                // ëŒ€íšŒ ì •ë³´ í‘œì‹œ
                document.getElementById('race-title').innerText = race.title;
                document.getElementById('admin-desc').innerText = race.description || 'ëŒ€íšŒ ì •ë³´ê°€ ê³§ ì—…ë°ì´íŠ¸ ë©ë‹ˆë‹¤.';
                
                // 16. ì˜ìƒ URL ì„¤ì •
                if (race.video_url) {
                    document.getElementById('youtube-player').src = `https://www.youtube.com/embed/${race.video_url}`;
                }

                // 1. ì „ì²´ ë¦¬ë·° ê°€ì ¸ì˜¤ê¸° ë° í‰ê·  ê³„ì‚°
                const { data: allReviews, error: reviewsError } = await _supabase
                    .from('reviews')
                    .select('*')
                    .eq('race_id', raceId);

                if (reviewsError) throw reviewsError;

                if (allReviews && allReviews.length > 0) {
                    // 1. ëŒ€íšŒ í‰ê· ì¹˜ ê³„ì‚° (5ê°œ í•­ëª©ì˜ í‰ê· )
                    const totalSum = allReviews.reduce((sum, r) => {
                        return sum + (r.course + r.management + r.supplies + r.souvenirs + r.cost_effective);
                    }, 0);
                    const avgScore = (totalSum / (allReviews.length * 5)).toFixed(1);
                    
                    document.getElementById('user-val').innerText = avgScore;
                    document.getElementById('user-avg-badge').className = `badge-circle ${getScoreColorClass(avgScore)}`;
                    document.getElementById('user-count').innerText = `${allReviews.length}ëª…ì˜ ëŸ¬ë„ˆê°€ ì°¸ì—¬í•¨`;

                    // 2, 7. ë² ìŠ¤íŠ¸ ëŒ“ê¸€ 3ê°œ ì„ ì • (ì‹ ê³  ë¸”ë¼ì¸ë“œ ì œì™¸)
                    const validReviews = allReviews.filter(r => {
                        const isBlinded = (r.reports >= 5 && r.reports > (r.likes || 0));
                        return !isBlinded;
                    });

                    const sortedByLikes = validReviews.sort((a, b) => (b.likes || 0) - (a.likes || 0));
                    const bestComments = sortedByLikes.slice(0, 3);
                    bestIds = bestComments.map(b => b.id);

                    renderBestComments(bestComments);
                } else {
                    document.getElementById('user-val').innerText = '-';
                    document.getElementById('user-count').innerText = 'ì•„ì§ ì°¸ì—¬í•œ ëŸ¬ë„ˆê°€ ì—†ìŠµë‹ˆë‹¤';
                }

                // 3. ìµœì´ˆ 10ê°œ ë¦¬ë·° ë¡œë“œ
                await loadMore();

                // 11. ì—°ê´€ ëŒ€íšŒ ë¡œë“œ
                await loadRelatedRaces();

                // ë¡œë”© ì™„ë£Œ
                document.getElementById('status-view').style.display = 'none';
                document.getElementById('main-view').style.display = 'block';

            } catch (err) {
                console.error('ì´ˆê¸°í™” ì˜¤ë¥˜:', err);
                alert('ëŒ€íšŒ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // 2, 15. ë² ìŠ¤íŠ¸ ëŒ“ê¸€ ë Œë”ë§
        function renderBestComments(reviews) {
            const area = document.getElementById('best-comments-area');
            
            if (!reviews || reviews.length === 0) {
                area.style.display = 'none';
                return;
            }

            area.style.display = 'block';
            area.innerHTML = reviews.map(r => {
                // ê°œë³„ í‰ê·  ì ìˆ˜ ê³„ì‚°
                const avgScore = ((r.course + r.management + r.supplies + r.souvenirs + r.cost_effective) / 5).toFixed(1);
                const cleanText = (r.comment || '').trim();
                const isLong = cleanText.length > 50;
                const shortText = isLong ? cleanText.substring(0, 50) + '...' : cleanText;
                
                return `
                <div class="best-mini-item">
                    <span class="best-tag">BEST</span> 
                    <b style="color:var(--main-color); margin-right:6px;">${avgScore}ì </b>
                    <span id="best-txt-${r.id}">${shortText}</span>
                    ${isLong ? `<span class="more-text-btn" onclick="expandBestComment('${r.id}', \`${cleanText.replace(/`/g, '\\`').replace(/\\/g, '\\\\')}\`, this)">ë‚´ìš© ë”ë³´ê¸°</span>` : ''}
                </div>`;
            }).join('');
        }

        // ë² ìŠ¤íŠ¸ ëŒ“ê¸€ ì „ì²´ ë³´ê¸°
        function expandBestComment(id, fullText, btn) {
            document.getElementById(`best-txt-${id}`).innerText = fullText;
            btn.remove();
        }

        // 3. 10ê°œì”© í˜ì´ì§• ë¡œë“œ
        async function loadMore() {
            try {
                const { data, error } = await _supabase
                    .from('reviews')
                    .select('*')
                    .eq('race_id', raceId)
                    .order('created_at', { ascending: false })
                    .range(offset, offset + 9);

                if (error) throw error;

                if (data && data.length > 0) {
                    const reviewList = document.getElementById('review-list');
                    
                    // ë² ìŠ¤íŠ¸ ëŒ“ê¸€ì´ ì•„ë‹Œ ê²ƒë§Œ í‘œì‹œ
                    const normalReviews = data.filter(r => !bestIds.includes(r.id));
                    const html = normalReviews.map(r => createReviewItem(r)).join('');
                    reviewList.insertAdjacentHTML('beforeend', html);

                    offset += 10;

                    // ë” ì´ìƒ ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ë”ë³´ê¸° ë²„íŠ¼ ìˆ¨ê¹€
                    if (data.length < 10) {
                        document.getElementById('load-more-container').style.display = 'none';
                    }
                }

            } catch (err) {
                console.error('ë¦¬ë·° ë¡œë“œ ì˜¤ë¥˜:', err);
            }
        }

        // 8, 9, 12. ë¦¬ë·° ì•„ì´í…œ ìƒì„±
        function createReviewItem(r) {
            // 9. ê°œë³„ í‰ê·  ì ìˆ˜ ê³„ì‚°
            const avgScore = ((r.course + r.management + r.supplies + r.souvenirs + r.cost_effective) / 5).toFixed(1);
            
            // 4. ë¸”ë¼ì¸ë“œ ì—¬ë¶€ ì²´í¬
            const isBlinded = (r.reports >= 5 && r.reports > (r.likes || 0));
            
            // 12. ì½”ë©˜íŠ¸ ê³µë°± ìµœì í™”
            const cleanComment = r.comment ? r.comment.trim().replace(/\n{3,}/g, '\n\n') : 'ì½”ë©˜íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.';

            return `
            <div class="review-item" id="rev-${r.id}">
                <div class="review-meta">
                    <span style="font-weight:900;">
                        ğŸ‘¤ ${r.author_name} 
                        <span class="score-tag ${getScoreColorClass(avgScore)}" style="color:white; margin-left:5px;">
                            ${avgScore}ì 
                        </span>
                    </span>
                    <span>${new Date(r.created_at).toLocaleDateString()}</span>
                </div>
                ${!isBlinded ? `
                    <div class="review-scores">
                        <span class="score-tag">ğŸ—ºï¸ ì½”ìŠ¤ ${r.course}</span>
                        <span class="score-tag">ğŸ¢ ìš´ì˜ ${r.management}</span>
                        <span class="score-tag">ğŸ¥› ë³´ê¸‰ ${r.supplies}</span>
                        <span class="score-tag">ğŸ‘• ê¸°ë…í’ˆ ${r.souvenirs}</span>
                        <span class="score-tag">ğŸ’° ê°€ì„±ë¹„ ${r.cost_effective}</span>
                    </div>
                    <div class="review-text">${cleanComment}</div>
                ` : `
                    <p style="color:#bbb; font-style:italic; font-size:0.85rem;">
                        ì‹ ê³  ëˆ„ì ìœ¼ë¡œ ë¸”ë¼ì¸ë“œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.
                    </p>
                `}
                <div class="interaction-bar">
                    <button class="inter-btn" onclick="handleLike('${r.id}', ${r.likes || 0})">
                        <i class="fa-regular fa-thumbs-up"></i> ${r.likes || 0}
                    </button>
                    <button class="inter-btn" onclick="handleReport('${r.id}', ${r.reports || 0})">
                        <i class="fa-solid fa-ban"></i> ì‹ ê³ 
                    </button>
                    <div class="review-actions">
                        <span onclick="handleDelete('${r.id}')">ì‚­ì œ</span>
                    </div>
                </div>
            </div>`;
        }

        // 11. ì—°ê´€ ëŒ€íšŒ ë¡œë“œ (ë¯¸ê°œìµœ ëŒ€íšŒ ì¤‘ ì¡°íšŒìˆ˜ ìˆœ)
        async function loadRelatedRaces() {
            try {
                const today = new Date().toISOString().split('T')[0];
                
                const { data, error } = await _supabase
                    .from('schedules')
                    .select('*')
                    .neq('id', raceId)
                    .gte('race_date', today)
                    .order('views', { ascending: false })
                    .limit(4);

                if (error) throw error;

                if (data && data.length > 0) {
                    document.getElementById('related-list').innerHTML = data.map(r => `
                        <div class="rel-card" onclick="location.href='race_detail.html?id=${r.id}'">
                            <img src="${r.poster_url || 'https://via.placeholder.com/400x300'}" 
                                 style="width:100%; height:120px; object-fit:cover;"
                                 alt="${r.title}">
                            <div class="rel-title">${r.title}</div>
                        </div>
                    `).join('');
                } else {
                    document.getElementById('related-list').innerHTML = '<p style="color:#999; grid-column: 1 / -1; text-align:center;">ì—°ê´€ ëŒ€íšŒê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                }

            } catch (err) {
                console.error('ì—°ê´€ ëŒ€íšŒ ë¡œë“œ ì˜¤ë¥˜:', err);
            }
        }

        // 5. ì¢‹ì•„ìš” ê¸°ëŠ¥
        async function handleLike(id, currentLikes) {
            try {
                const { data, error } = await _supabase
                    .from('reviews')
                    .update({ likes: currentLikes + 1 })
                    .eq('id', id)
                    .select();

                if (error) throw error;

                if (data && data.length > 0) {
                    location.reload();
                } else {
                    alert('ì¢‹ì•„ìš” ì²˜ë¦¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }

            } catch (err) {
                console.error('ì¢‹ì•„ìš” ì˜¤ë¥˜:', err);
                alert('ì¢‹ì•„ìš” ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // 6. ì‹ ê³  ê¸°ëŠ¥
        async function handleReport(id, currentReports) {
            if (!confirm("ì´ ë¦¬ë·°ë¥¼ ì‹ ê³ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                return;
            }

            try {
                const { data, error } = await _supabase
                    .from('reviews')
                    .update({ reports: currentReports + 1 })
                    .eq('id', id)
                    .select();

                if (error) throw error;

                if (data && data.length > 0) {
                    alert('ì‹ ê³ ê°€ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    location.reload();
                } else {
                    alert('ì‹ ê³  ì²˜ë¦¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }

            } catch (err) {
                console.error('ì‹ ê³  ì˜¤ë¥˜:', err);
                alert('ì‹ ê³  ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // 10. ì‚­ì œ ê¸°ëŠ¥
        async function handleDelete(id) {
            const password = prompt("ë¦¬ë·° ì‘ì„± ì‹œ ì…ë ¥í•œ ì•”í˜¸ 6ìë¦¬ë¥¼ ì…ë ¥í•˜ì„¸ìš”:");
            
            if (!password) {
                return;
            }

            try {
                const { data, error } = await _supabase
                    .from('reviews')
                    .delete()
                    .eq('id', id)
                    .eq('password', password)
                    .select();

                if (error) throw error;

                if (data && data.length > 0) {
                    alert('ë¦¬ë·°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                    location.reload();
                } else {
                    alert('ì•”í˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.');
                }

            } catch (err) {
                console.error('ì‚­ì œ ì˜¤ë¥˜:', err);
                alert('ì‚­ì œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        window.onload = init;
    </script>
</body>
</html>